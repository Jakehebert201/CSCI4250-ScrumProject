<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Center Â· Student Success Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-container">
        {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <header class="hero compact">
        <h1>Notification Center</h1>
        <p>Broadcast announcements and review recent alerts received by students.</p>
        <a class="cta" href="{{ url_for('index') }}">Return to Dashboard</a>
    </header>

    <main class="notification-center">
        <section class="card form-card">
            <h2>Send Notification</h2>
            <form action="{{ url_for('send_notification') }}" method="post" class="stack">
                <label>
                    Professor ID
                    <input type="text" name="professor_id" placeholder="p2001" required>
                </label>
                <label>
                    Title
                    <input type="text" name="title" maxlength="80" required>
                </label>
                <label>
                    Message
                    <textarea name="message" rows="4" maxlength="400" required></textarea>
                </label>
                <button type="submit" class="cta">Send to Students</button>
            </form>
        </section>

        <section class="card">
            <h2>Recent Notifications</h2>
            {% if notifications %}
            <ul class="notification-list full">
                {% for notification in notifications %}
                <li>
                    <article>
                        <header>
                            <h3>{{ notification.title }}</h3>
                            <p class="muted small">Sent {{ notification.sent_at.strftime('%b %d, %Y %H:%M') }} UTC by {{ notification.sender_id }}</p>
                        </header>
                        <p>{{ notification.message }}</p>
                        <footer class="notification-actions">
                            <span class="muted small">Read by {{ notification.read_by|length }} students</span>
                            {% if default_student_id %}
                            <form action="{{ url_for('mark_notification_read', notification_id=notification.notification_id) }}" method="post">
                                <input type="hidden" name="student_id" value="{{ default_student_id }}">
                                <button type="submit" class="cta tertiary">Mark Read for {{ default_student_id }}</button>
                            </form>
                            {% endif %}
                        </footer>
                    </article>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="muted">No notifications have been sent yet.</p>
            {% endif %}
        </section>
    </main>

    <footer>
        <p>Powered by Flask and the Tracker sample dataset.</p>
    </footer>
</body>
</html>
