<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classes | Student Location Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
</head>
<body class="layout">
    <header class="page-header">
        <a class="brand" href="{{ url_for('main.landing_page') }}">Student Location Tracker</a>
        <nav class="page-nav">
            <a href="{{ url_for('main.student_dashboard') }}" class="nav__item">Dashboard</a>
            <a href="{{ url_for('classes.list_classes') }}" class="nav__item nav__item--active">Classes</a>
            <a href="{{ url_for('main.database') }}" class="nav__item">My Data</a>
            <a href="{{ url_for('auth.logout') }}" class="nav__item">Log Out</a>
        </nav>
    </header>
    
    <main class="dashboard">
        <section class="dashboard__panel">
            <h1>My Classes</h1>
            <p class="dashboard__subtitle">View your enrolled classes and discover new courses.</p>

            <!-- Enrolled Classes -->
            <div style="margin-bottom: 3rem;">
                <h2 style="color: var(--primary); margin-bottom: 1rem;">üìö My Enrolled Classes</h2>
                {% if enrolled_classes %}
                    <div style="display: grid; gap: 1rem;">
                        {% for class in enrolled_classes %}
                        <div class="card" style="padding: 1.5rem; border-left: 4px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h3 style="margin: 0;">
                                        <a href="{{ url_for('classes.view_class', class_id=class.id) }}" style="text-decoration: none; color: var(--primary);">
                                            {{ class.full_course_name }}
                                        </a>
                                    </h3>
                                    {% if class.section %}
                                        <p style="margin: 0.25rem 0; opacity: 0.8;">Section {{ class.section }}</p>
                                    {% endif %}
                                    <p style="margin: 0.5rem 0;"><strong>Professor:</strong> {{ class.professor.full_name }}</p>
                                </div>
                                <form method="post" action="{{ url_for('classes.drop_class', class_id=class.id) }}" 
                                      onsubmit="return confirm('Are you sure you want to drop this class?')">
                                    <button type="submit" class="btn btn--secondary" style="background: #ef4444;">
                                        üóëÔ∏è Drop
                                    </button>
                                </form>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                                <div>
                                    <strong>Schedule:</strong> {{ class.meeting_days or 'TBD' }}<br>
                                    {% if class.start_time and class.end_time %}
                                        {{ class.start_time.strftime('%I:%M %p') }} - {{ class.end_time.strftime('%I:%M %p') }}
                                    {% endif %}
                                </div>
                                <div>
                                    <strong>Room:</strong> {{ class.room or 'TBD' }}<br>
                                    <strong>Credits:</strong> {{ class.credits }}
                                </div>
                                <div>
                                    <strong>Semester:</strong> {{ class.semester }} {{ class.year }}<br>
                                    <strong>Enrolled:</strong> {{ class.enrollment_count }}/{{ class.capacity }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card" style="text-align: center; padding: 2rem; opacity: 0.8;">
                        <p>You're not enrolled in any classes yet. Browse available classes below to get started!</p>
                    </div>
                {% endif %}
            </div>

            <!-- Available Classes -->
            <div>
                <h2 style="color: var(--primary); margin-bottom: 1rem;">üîç Available Classes</h2>
                {% if all_classes %}
                    <div style="display: grid; gap: 1rem;">
                        {% for class in all_classes %}
                        {% set is_enrolled = class.is_student_enrolled(student) %}
                        {% if not is_enrolled %}
                        <div class="card" style="padding: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div>
                                    <h3 style="margin: 0;">
                                        <a href="{{ url_for('classes.view_class', class_id=class.id) }}" style="text-decoration: none; color: var(--text);">
                                            {{ class.full_course_name }}
                                        </a>
                                    </h3>
                                    {% if class.section %}
                                        <p style="margin: 0.25rem 0; opacity: 0.8;">Section {{ class.section }}</p>
                                    {% endif %}
                                    <p style="margin: 0.5rem 0;"><strong>Professor:</strong> {{ class.professor.full_name }}</p>
                                </div>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    {% if class.is_full %}
                                        <span style="background: #ef4444; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">Full</span>
                                    {% elif not class.enrollment_open %}
                                        <span style="background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">Closed</span>
                                    {% else %}
                                        <span style="background: #22c55e; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">Open</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <strong>Schedule:</strong> {{ class.meeting_days or 'TBD' }}<br>
                                    {% if class.start_time and class.end_time %}
                                        {{ class.start_time.strftime('%I:%M %p') }} - {{ class.end_time.strftime('%I:%M %p') }}
                                    {% endif %}
                                </div>
                                <div>
                                    <strong>Room:</strong> {{ class.room or 'TBD' }}<br>
                                    <strong>Credits:</strong> {{ class.credits }}
                                </div>
                                <div>
                                    <strong>Semester:</strong> {{ class.semester }} {{ class.year }}<br>
                                    <strong>Available:</strong> {{ class.available_spots }}/{{ class.capacity }} spots
                                </div>
                            </div>
                            
                            {% if class.description %}
                                <p style="margin: 1rem 0; opacity: 0.9;">{{ class.description }}</p>
                            {% endif %}
                            
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <a href="{{ url_for('classes.view_class', class_id=class.id) }}" class="btn btn--secondary">
                                    üìã View Details
                                </a>
                                {% if class.enrollment_open and not class.is_full %}
                                    <form method="post" action="{{ url_for('classes.enroll_in_class', class_id=class.id) }}" style="display: inline;">
                                        <button type="submit" class="btn btn--primary">
                                            ‚ûï Enroll
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card" style="text-align: center; padding: 2rem;">
                        <p>No classes are currently available for enrollment.</p>
                    </div>
                {% endif %}
            </div>
        </section>
    </main>
    
    <footer class="footer">
        <small>&copy; 2025 Student Tracker. Built with Flask.</small>
    </footer>
    <script src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>
</html>